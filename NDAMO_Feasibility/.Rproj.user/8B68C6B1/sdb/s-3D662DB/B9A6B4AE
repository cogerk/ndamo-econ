{
    "collab_server" : "",
    "contents" : "nit_denit<- function(V, pH, Temp, cNin, cCODin){\n\n\n  # Mass and energy balance for mainstream anaerobic membrane bioreactor \n  # with NDAMO and Anammox nitrogen removal system.\n  # Takes input wastewater concentrations and returns \n    # 1) Oxygen Requirements, \n    # 2) Sludge Production,\n    # 3) Methane production\n    # 4) % Dissolved Methane Consumed\n    # 4) Alkalinity req'mts?\n  # Kathryn Cogert 12/6/15\n  # Updated 8/5/16\n  \n  # Input Parameters\n  # V, ML/day, influent flowrate\n  # pH, system pH\n  # Temp, deg C, influent temperature\n  # cNin, mg/l, concentration of nitrogen in influent\n  # cCODin, mg/l, concentration of COD in influent\n  \n  # TODO: Include temperature and pH effects\n  # TODO: Greenhouse gas production? Where to draw the box?\n  \n  ### Constants\n  MW_O2 = 32\n  MW_CH4 = 16\n  MW_N = 14\n  CH4_COD = 4\n  ## Methane Production\n  rho_CH4 = 0.65477\n  n_BG = 0.95 #Biogas Burning Eff.\n  n_Cogen = 0.39 #Cogen Efficiency\n  H_CH4 = 23 #MJ/m3, methane caloric potential\n  \n  # Nitrogen\n  sO2_AOB = 1.5 # Oxygen stoich coeff AOB \n  sO2_NOB = 0.5 # Oxygen stoich coeff NOB \n  \n  # Sludge production Factors\n  fx_AnMBR = 0.14  # gCOD/gCOD, gCOD of sludge produced in AnMBR per gCOD eaten, Yeo, 2015 (Confirm)\n  fx_HET = 0.56    # gCOD/gCOD, gCOD of sludge produced per gCOD eaten by heterotrophs, Citation needed\n  fx_AOB = 0.20    # gCOD/gN, gCOD of sludge produced per gN eaten by AOB, Wiesmann, 1994\n  fx_NOB = 0.06    # gCOD/gN, gCOD of sludge produced per gN eaten by NOB, Wiesmann, 1994 T=20C pH=8\n  fx_anamx = 0.17  # gCOD/gN, gCOD of sludge produced per gN eaten by anammox.  Van der Starr\n  fx_NDAMO = 0.22  # gCOD/gCH4,\tgCOD of sludge produced per gCH4 eaten by NDAMO.  From Metabolic reaction\n  n = 1.4          # gVSS/gCOD, conversion constant\n  fCOD_HET = 5     # gCOD/gN, gCOD required per gN eaten by denitrifiers.  From Metabolic reaction\n  #fSolids=0.1    # gVSS/gSludge, fraction of solids in final sludge from plant\n  \n  ## Nitrogen system\n  fN_AOB = 1 # wt%, fraction of total N in converted by AOB, see appendix\n  \n  ## AnMBR System\n  MixingEnergy = 0.15 #kWh/m3, Mixing energy of reactor calculated per reactor volume, Damien Batstone\n  HRT_AnMBR = 1 #days, Damien Batstone\n  MembraneScouringEnergy=0.25 #kWh/kL/d, scouring energy per flowrate, Damien Batstone\n  \n  ## Cost Factors - Commented out b/c we are going to no cost model\n  #C_Elect_Seattle=0.02; %$/kWh\n  #C_SHARONAerationpN=1.38; %$/kgN\n  #C_SludgeTreatment=100; %$/metric ton\n  \n  ### Calcuations\n  LNin = V * cNin #kgN/d, Nitrogen load per day\n  LNcent = .4 * LNin #kgN/d, Nitrogen load from centrate, assumed 40% of total load\n  LN = LNin + LNcent #kgN/d, total nitrogen load\n  LCOD_inf = V * cCODin #kgCOD/d, COD load per day\n  \n  \n  # Nitrogen Removal System\n  fN_NOB = fN_AOB  # wt%, frac of totN converted by NOB, assumed 100% in NDAMO system\n  O2_AOB = (fN_AOB * LNin) / MW_N * MW_O2 * sO2_AOB # kg/D O2 req'd by AOB\n  O2_NOB = (fN_NOB * LNin) / MW_N * MW_O2 * sO2_NOB # kg/D O2 req'd by NOB\n  px_AOB = fN_AOB*fx_AOB*n*LN #kg/d, sludge produced from AOB\n  px_NOB = fN_NOB*fx_NOB*n*LN #kg/d, sludge produced from NOB\n  \n\n  # Denitrification\n  COD_reqd = LNin * fCOD_HET # ammt of COD req'd.\n  COD_added = max(0,COD_reqd-LCOD_inf)\n\n  px_denit = fx_HET*max(COD_reqd,LCOD_inf)\n  if(COD_added==0){\n    O2_denit = LCOD_inf-COD_reqd\n  } else{\n    O2_denit = 0\n  }\n  O2_dem = O2_AOB + O2_NOB + O2_denit # Total stoichiometric O2 Demand\n  \n  #Slude Produced\n  px_TOT = px_denit+px_AOB+px_NOB #kg/d, total sludge produced\n\n  # Anaerobic Digester\n  #LCH4dis_eff=(cCH4dis*V-LCH4_cons)/V; %mg/L, methane in effluent\n  fx_digester = 0.59 # Assumed digester sludge conversion\n  px_TOT = px_TOT * (1-fx_digester)\n  CH4prod_COD = px_TOT * fx_digester # kg CH4 produced as COD/day\n  CH4prod = CH4prod_COD * CH4_COD # kg CH4 produced/day\n  fCH4gas = 0.62 # Assume 62% of biogas is methane\n  P=1 # atm, system pressure\n  H=0.0015 # Henry's Constant, (Add temperature and pH dependence)\n  CH4gas = CH4prod # Assume all Methane goes to gas phase\n  CO2gas = CH4gas/fCH4gas*(1-fCH4gas) # Assume balance of biogas is CO2\n  LCH4gas = CH4gas/rho_CH4 #m3/d, volume methane produced\n  \n  \n  Results= data.frame(V, pH, Temp, cNin, cCODin, COD_added, px_TOT, O2_dem, LCH4gas)\n  return(Results)\n  }\n\n",
    "created" : 1472830442062.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "3481151141",
    "id" : "B9A6B4AE",
    "lastKnownWriteTime" : 1472851644,
    "last_content_update" : 1472851644793,
    "path" : "~/Reference/ndamo-econ/NDAMO_Feasibility/scenarioA.R",
    "project_path" : "scenarioA.R",
    "properties" : {
    },
    "relative_order" : 1,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}